import admin from 'firebase-admin'; 
import dotenv from 'dotenv';

dotenv.config();

const serviceAccountBase64 = process.env.FIREBASE_SERVICE_ACCOUNT_KEY || 'ew0KICAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLA0KICAicHJvamVjdF9pZCI6ICJjaGF0LWQzM2JkIiwNCiAgInByaXZhdGVfa2V5X2lkIjogIjk1N2Q0Mjk0MTYyN2ZhMjViYzYwNDU5MzU4MjZhNzNjZGZkNjI3ZWIiLA0KICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURjVU5NT1g2QWZoc25OXG5JUnYrNlh1aURYQ1U4OTV1UDlKUkp4UWZBMjJ1OWxOWnlVM2JTWGJTdFNJZ05xUC9jbGIvWFlvNUJINmJUTTliXG5tYXFlN1A2NFFOclBpczNoRVRDbFp3Zk1oZnNpV2tWZVhHYjFTVklCT3hPSzlKa2JiSExKenA5S05JeS8wS3RPXG5JK3k5dlROMGxvN0tpcUNwc3RSZFExd0I0cEVKWXNCdDBLeEVSdWE3SG0rczZLcmJvNVoveDhQSmFIMS92ZU9rXG4xNTlSNWMxRWtrdU5ZUzZmdkQ5TVV3RHVlQnZlcUxGOElGamVRUWpJZWNLYzB5ZzZZZTBQczVGcEFUdXBKM1lMXG5GMnZxOEgxM0kwUTQ5YklqRGxkYmpuNGsySWxVb2RqV1NZOVAzRzZFVHZUbGtJL2hXbVdrWFp4RktBa2xRSGVtXG5VRUFBNWt5WkFnTUJBQUVDZ2dFQUlqNnE2NjFIODVhTktBWVpOcWgrbDl3TWI0NnZlSVlSa0IwcHByOXU3VmJxXG44a1lVeEx6WXpCd3RDNEpLd0FJN0RSTHlVUFlHb3VlUHhKNXdVNmNsV2FqMUNmVDZsdDBINlhISUY4Mk1rVlNrXG5PeXhVTVpTOXV5UytYeWN4WkQ2WllnNXNtb2xzQmtXdVZ1VkZIMkg1RFVwNHMvbFR5MFRaZHd5cEVMN3hpZHBtXG5hamN0ek04TG9IZmE4bERlNGNHSDF3L2Q2NzVFczlzbVNKV0xRNVJZL3cyWUNTVE1Vb0FBWFZwYWVKaThtM0p6XG5zK2E5d2V5Yk1DZHBpd2xLUUNyYnFYVEIydys1WW5pQWlrK21za1FacmdycXgwM3M1WXgvOVdGeXZHUU1Ec09hXG44UnhYSFVGTlJJOTlKRXA3bDk2VlhRbDF5d3kxR1V5YnBwUTlWbXJLYlFLQmdRRCtsL0dxcXV2V1dYTHM1b3U2XG44Qi9VbTRwRU9LbUp4WVViaXVYZ1J0bWJjM0Y3dHBKUlNWclZRV1dVeHZRMzNSaVBwUWQ5YzFic3hDK2xmaHlPXG4wM2NDWkFzeXBaUDFIdzN1S2hDUUlvY2hGRE55d2RwV1RWY2RBemJ6T0pYaGdBdEZsY0ZZQVZkb1ZxZm1hSzJGXG5rcE94TkN1SzVIZlZqMUcvc0ZuV3hCRnY5UUtCZ1FEZGlHZEc2T2VOYXowcUJZUEhLVDUrcThLVnBXK3ZXWmtaXG5CMklrQ2s5TVExNjRGYW9CU1NEbW9CdzUvUTA3SXNjcndHNDlxdzBwOXNxejE3RWVxODN0SzErMW8zQ1U0c0JGXG55S0gxYVhYYnhUT2MzSFhIdUxSNE9lTExqb2pmUEZyZlFTRE56S2NUWE9LeFlsb2VYenQ3Tk5YRi8zbjhEeXVYXG51RDZOQWRpM2xRS0JnQU1ibDdlZG5vTmZWQ2ZRS0tSL2llUHVnaUdURDM2L0NvRHJrU0xMdXB4TExIZDJJeE1hXG44aURvUzNVbGVKVzEvVGJEclBPN0ZMU1BNSVcwcEdTWjhEbjNQcXUvbWE3RVVrYzEvRDNHTGlBWlB3ZUhsa0szXG5idmpMc1VBRzBNMlA0cE5XNEtWU1h0N0hNQVdBQVo0L3k4Mjk5VW9jdjltN2hpUHc0eWZiL05xQkFvR0JBTDBGXG5lUkd4QW5uUktjUWtKbmVXQW9QMHJEZ2hpN1V6bndVVEhyTWZ0Titla0VCRUErWEs3dTY1YUx3MTVjY3llbjBqXG5XU3ozT1drMzhXY1lRRUdxV0Mvb2xXYVhpU1VRZ1B4S0g1OFZtQUdvTnN5OTh5VXh2WkxqMlZiVVRJY2xxV2ZhXG4yMUdlTUdTK0daTS9GeVBaSUJpVlVWMzdDYXQvaWpPUGVwZTRIcUV0QW9HQkFKbVEzcms1ZDdVSGtYZEFRTnNkXG4vS3BPYjBNS3lQMmVDb1pBWHJzRU54aGgvcU1hMXdLNWMxbitXS3FkZXd5d3FHa1NiOXA2akc2UlRoZmZiN3FPXG5KWUVEcUpGVEhHUXdlRUlpK3F6aE9ENFhCbVZMbitQZVJkK08rYk1HbVJ4MDM5TnVYdHlKYllZWEduWU1QLzhnXG41dWh1VGFPM1VmTHVSVjhLV0hlSDdXbW5cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsDQogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstZmJzdmNAY2hhdC1kMzNiZC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsDQogICJjbGllbnRfaWQiOiAiMTA2ODEyODY0Nzk3NDAxOTE3MzYyIiwNCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwNCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsDQogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwNCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZmlyZWJhc2UtYWRtaW5zZGstZmJzdmMlNDBjaGF0LWQzM2JkLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwNCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSINCn0NCg=='

// console.log(serviceAccountBase64);

if (!serviceAccountBase64) {
  throw new Error("Missing FIREBASE_SERVICE_ACCOUNT_KEY in .env file");
}

try {
  const serviceAccountJson = Buffer.from(serviceAccountBase64, 'base64').toString('utf-8');
  
  const serviceAccount = JSON.parse(serviceAccountJson);
  // console.log("This is service account key",serviceAccount);
  
  admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
    });
} catch (error) {
  console.log("Error while retriving service account", error);
}

export default admin;

import admin from 'firebase-admin'; 
import dotenv from 'dotenv';

dotenv.config();

const serviceAccountBase64 = process.env.FIREBASE_SERVICE_ACCOUNT_KEY || "ew0KICAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLA0KICAicHJvamVjdF9pZCI6ICJjaGF0LWQzM2JkIiwNCiAgInByaXZhdGVfa2V5X2lkIjogIjcyZWQ0OTkyNzQ2ODFjYTdlZmRjNjRiOWJiZTYzN2JhZjhjZWNhOGMiLA0KICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUUNmSE5CMldDc2JjLy8xXG5oU3BQMGRaYXR5MG80OUJJZmp5NnFPQXozWFpMYWVvWXNwR3FBSWFMQ2x3WndBRElqMnkvSDFNdndWM0IxZnJ6XG5yWkZCeFJUc1l0bTAxWnFxYnl2M1FINVFYNkZxdi9CTm1OeDQ2a2d5b0FtaktqdkhqVkhPNWFjN2pqSzJjN0xYXG5tVnB2U0ZxNy90VlVVRDFOODVlN1ZPMFJaWEpqa0FRRm1EU1VNbHp0TVl6b2Z3OU9YUG93ZjJtRmhxYVRYNmt6XG5KZlphdU4xWEtqdTQySmJpVDMrRnpYN0VLeGM0WDRudmdXdjZzVGpHR1RxRTB3ZUFIQjVGMFZjVnN5L3BGUWtxXG5QcDFKSDZxTlVuWG9xVU51RTMxNmp3eFlmdXg3dUZMLzV6eGFNdW5MblFLdTQ2NXhhNEd6ZHU0Zit3NFh5WnplXG43NEpKdGRNbEFnTUJBQUVDZ2dFQURScjhlS0x1ZWdabDhMMFZMUm5sZy9kT2V1MjR2Qi9adEs0d09WVm1adlBFXG5XbUJxNnd1OENUdkROa1BBVE1TemVsS0VNWXpGd2k5enlocGp1bjBYS2hsQ1FVak93bmNCc2czWDJacm0ycm9RXG5ldk82UlNOVzZ3U1BocWIxNFl2Y1R5UlBUL0o0YnRxOHdsRlpSNDA0Ry8velpreHRvRHdPSlZuclpPRnNPSk1FXG51Rm5IQTNKajYxOFNoYzhkNGdNZ1dkZnJrNU1NZ29yQ3JQOVNuVFZDM082Rk9PM3lVV0dtT0FnY0lkMFFoWGhUXG42Q2toV0o3MG1NUGkrczRjQ0ZndVlZdFV2dWJER0pwT2lmOHNCMmZKcEJ0WGFTOTlweWQvazJJZmJGL21laHlnXG5BQVlTWEFqcWJZbXI0ZHdjKzVPOVdwQkE4OExEWGdPZ2hZTnhIU2F6UVFLQmdRRGU3eHIwLytkZWtyOGFPNkR0XG53ZkdHRlZKTXdBSlc0ZWNRN3pqU1kzcVU1bzl2SFRNeVI4UFZidVN3NVdGQ09ab0cxQncyZ05EMDA1SGU4RExrXG5IZ2QvK1h2TXpOUWgwZjltOFhIUGlidmtvaGZSMkVNdTlhQlMrMkh5eCtuRFk0Z09CYXlhNDZWNTlTVU1EMXJ6XG5wbjNBQzVGYzVZQUtIOHg0UUtTMG43OHJmUUtCZ1FDMnRtSDJNOE9UOFdheEMzTS84Um8rcU42Q1lUc1ZTUHNsXG5PVTJmRGt3NCtGMDcvT2dic2lvdGVNZG93dkRNRGMvNXBYS2JLc0hDeG1hTlA4Y3RPZHFoY1BXNlhOQXA2VXpnXG5oaDNONlBGVm54emhnSGYzZ3J2aG5EYnREbnNKVWJYUUYzQjh3RWtITWwrZFMvaTFIY3NYazFVNmlPOVh4M2t1XG5iYnNUY2dMR3lRS0JnRWkwOXJlODFqcXo1WHVxd3R1SUN6dE5yTiszSjR3cWRPL0M5V2M0Wm53MWpjWVJZZWNlXG5ITEo1VGtDYkx0TW9jaUdULy9lT241ZVpnTk9TeHlZNjNQdFI1Snh3bVNiR2xHT0FqenUra2ZjSkhuZWo3cFZjXG5Lb09sMU5ZWGVSZnVXQ3Nxa3BhWmRCaUlhU0s3eDAvN2xydVJpa0VmNEZoczhvU3RvSW9BSjVzSkFvR0FYcTVLXG5PMVA5c0dkeTZLSGZXaTR0aEhUcndUSnpkSWM2SmNMNUYwaElkV2sybjBSaVh4L0hQWU1PQ3BxaVA0dVV6M0JOXG40RnlheGIwY0hXd0VZY3BPSWtTd0FaL2creWI3Z0luZlhmbXRQY3BUSkFQM3B0b25WRFVvUFZXNHFrNmVZYlFUXG54WUc3RmpDalhaYWx6ZTBmZGhzU0dtQWxieDVlREpJdVZGaExXZ2tDZ1lFQXRWQXRZYmM1OCt3N3hZTi94MWQ2XG5qdFE4aDJwcG9NclVIVi9VdktZbEJRdnVvdTRFZGh0cXJKMEs1TDlaS29INndjVDFFSjhMY2tQMFp4Slh5SmNwXG4zbjhRZTQ5SUpMNHJXMkFSWlQ2MlFQc3BLT1N0ZVVVK3diNkJ0eHpiQ3AxWkdqZ0UvTXFsVmY0RlVRNzhwanBLXG5adlBMc2hLdG5CcVNpeGV2aFBMU2RsZz1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsDQogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstZmJzdmNAY2hhdC1kMzNiZC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsDQogICJjbGllbnRfaWQiOiAiMTA2ODEyODY0Nzk3NDAxOTE3MzYyIiwNCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwNCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsDQogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwNCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZmlyZWJhc2UtYWRtaW5zZGstZmJzdmMlNDBjaGF0LWQzM2JkLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwNCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSINCn0NCg";

if (!serviceAccountBase64) {
  throw new Error("Missing FIREBASE_SERVICE_ACCOUNT_KEY in .env file");
}

try {
  const serviceAccountJson = Buffer.from(serviceAccountBase64, 'base64').toString('utf-8');
  
  const serviceAccount = JSON.parse(serviceAccountJson);
  
  admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
    });
} catch (error) {
  console.log("Error while retriving service account", error);
}

export default admin;
